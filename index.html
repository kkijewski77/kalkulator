<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Szkód Powodziowych</title>
    <style>
        /* Tutaj umieść style CSS z poprzedniej wersji */
    </style>
</head>
<body>
    <div class="overlay">
        <h1>Kalkulator Szkód Powodziowych</h1>
        <div class="container">
            <div class="card">
                <h2>Szkic mieszkania</h2>
                <svg viewBox="0 0 310 260" id="mieszkanie-svg"></svg>
            </div>
            <div class="card">
                <h2>Kalkulator szkód</h2>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="tryb-powierzchni"> Użyj całkowitej powierzchni mieszkania
                    </label>
                </div>
                <div class="form-group" id="calkowita-powierzchnia-container" style="display:none;">
                    <label for="calkowita-powierzchnia">Całkowita powierzchnia mieszkania (m²):</label>
                    <input type="number" id="calkowita-powierzchnia" value="64">
                </div>
                <div class="form-group">
                    <label for="cena-za-m2">Cena za m² naprawy:</label>
                    <input type="number" id="cena-za-m2" value="500">
                </div>
                <div id="stopnie-zalania-container"></div>
                <div class="form-group">
                    <h3>Szacunkowy koszt naprawy: <span id="koszt-naprawy">0</span> zł</h3>
                </div>
            </div>
        </div>
    </div>

    <script>
        const obszary = [
            { id: 'pokoj1', nazwa: 'Pokój 1', points: "10,10 150,10 150,100 10,100", powierzchnia: 20, powierzchniaProcentowa: 0.31 },
            { id: 'pokoj2', nazwa: 'Pokój 2', points: "160,10 300,10 300,100 160,100", powierzchnia: 18, powierzchniaProcentowa: 0.28 },
            { id: 'kuchnia', nazwa: 'Kuchnia', points: "10,110 150,110 150,200 10,200", powierzchnia: 12, powierzchniaProcentowa: 0.19 },
            { id: 'lazienka', nazwa: 'Łazienka', points: "160,110 300,110 300,200 160,200", powierzchnia: 6, powierzchniaProcentowa: 0.09 },
            { id: 'przedpokoj', nazwa: 'Przedpokój', points: "10,210 300,210 300,250 10,250", powierzchnia: 8, powierzchniaProcentowa: 0.13 },
        ];

        const stopnieZalania = [
            { id: 'brak', nazwa: 'Brak zalania', mnoznik: 0 },
            { id: 'lekkie', nazwa: 'Lekkie zalanie', mnoznik: 0.3 },
            { id: 'umiarkowane', nazwa: 'Umiarkowane zalanie', mnoznik: 0.6 },
            { id: 'ciezkie', nazwa: 'Ciężkie zalanie', mnoznik: 1 },
        ];

        let zaznaczoneObszary = {};
        let stopnieZalaniaObszarow = {};

        function initializeSVG() {
            const svg = document.getElementById('mieszkanie-svg');
            obszary.forEach(obszar => {
                const polygon = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
                polygon.setAttribute('points', obszar.points);
                polygon.setAttribute('fill', 'white');
                polygon.setAttribute('stroke', 'black');
                polygon.setAttribute('stroke-width', '2');
                polygon.onclick = () => toggleObszar(obszar.id);
                svg.appendChild(polygon);

                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                const [x, y] = obszar.points.split(' ')[0].split(',');
                text.setAttribute('x', x);
                text.setAttribute('y', y);
                text.setAttribute('dy', '20');
                text.setAttribute('dx', '5');
                text.setAttribute('font-size', '12');
                text.textContent = `${obszar.nazwa} (${obszar.powierzchnia} m²)`;
                svg.appendChild(text);
            });
        }

        function toggleObszar(id) {
            zaznaczoneObszary[id] = !zaznaczoneObszary[id];
            if (zaznaczoneObszary[id]) {
                stopnieZalaniaObszarow[id] = 'lekkie';
            } else {
                delete stopnieZalaniaObszarow[id];
            }
            updateSVG();
            updateStopnieZalania();
            obliczKoszt();
        }

        function updateSVG() {
            obszary.forEach(obszar => {
                const polygon = document.querySelector(`polygon[points="${obszar.points}"]`);
                polygon.setAttribute('fill', zaznaczoneObszary[obszar.id] ? 'red' : 'white');
            });
        }

        function updateStopnieZalania() {
            const container = document.getElementById('stopnie-zalania-container');
            container.innerHTML = '';
            Object.keys(zaznaczoneObszary).forEach(id => {
                if (zaznaczoneObszary[id]) {
                    const obszar = obszary.find(o => o.id === id);
                    const div = document.createElement('div');
                    div.className = 'form-group';
                    div.innerHTML = `
                        <label for="stopien-${id}">${obszar.nazwa} - Stopień zalania:</label>
                        <select id="stopien-${id}" onchange="zmienStopienZalania('${id}', this.value)">
                            ${stopnieZalania.map(stopien => 
                                `<option value="${stopien.id}" ${stopnieZalaniaObszarow[id] === stopien.id ? 'selected' : ''}>
                                    ${stopien.nazwa}
                                </option>`
                            ).join('')}
                        </select>
                    `;
                    container.appendChild(div);
                }
            });
        }

        function zmienStopienZalania(id, stopien) {
            stopnieZalaniaObszarow[id] = stopien;
            obliczKoszt();
        }

        function obliczKoszt() {
            const uzywaCalkowitejPowierzchni = document.getElementById('tryb-powierzchni').checked;
            const calkowitaPowierzchnia = parseFloat(document.getElementById('calkowita-powierzchnia').value);
            const cenaZaM2 = parseFloat(document.getElementById('cena-za-m2').value);

            const koszt = obszary.reduce((suma, obszar) => {
                if (zaznaczoneObszary[obszar.id]) {
                    const stopien = stopnieZalaniaObszarow[obszar.id];
                    const mnoznik = stopnieZalania.find(s => s.id === stopien).mnoznik;
                    const powierzchnia = uzywaCalkowitejPowierzchni
                        ? calkowitaPowierzchnia * obszar.powierzchniaProcentowa
                        : obszar.powierzchnia;
                    return suma + (powierzchnia * cenaZaM2 * mnoznik);
                }
                return suma;
            }, 0);

            document.getElementById('koszt-naprawy').textContent = koszt.toFixed(2);
        }

        document.getElementById('tryb-powierzchni').onchange = function() {
            document.getElementById('calkowita-powierzchnia-container').style.display = 
                this.checked ? 'block' : 'none';
            updateSVG();
            obliczKoszt();
        };

        document.getElementById('calkowita-powierzchnia').oninput = obliczKoszt;
        document.getElementById('cena-za-m2').oninput = obliczKoszt;

        // Inicjalizacja
        initializeSVG();
        obliczKoszt();
    </script>
</body>
</html>
